#!/bin/bash
# SPDX-License-Identifier: GPL-2.0

set -e
for f in `ls Packages/version.d/*`
  do
    source $f
  done
if [ -f "customize.sh" ] ; then
  source customize.sh
fi
for f in `ls Packages/version.d/_*`
  do
    source $f
  done
if [ -f "customize.sh" ] ; then
  source customize.sh
fi
cd Packages

echo "** Performing general actions **"
set -x
sed -i "s/cape_universal=enable/consoleblank=0 fbcon=rotate:1 omap_wdt.nowayout=0/" /boot/uEnv.txt
echo ${MASTER_HOSTNAME} >/etc/hostname
sed -i "s/arm/${MASTER_HOSTNAME}/g" /etc/hosts
#sed -i "s/AcceptEnv LANG LC_*/#AcceptEnv LANG LC_*/"  /etc/ssh/sshd_config
echo "** Set Master password to $MASTER_PASSWORD **"
echo "ubuntu:$MASTER_PASSWORD" | chpasswd
chown -R octo:octo ${UMIKAZE_HOME}

apt-get clean
apt-get autoclean
rm -rf /var/cache/doc*
apt-get -y autoremove
DATE=`date`
echo "$VERSION $DATE" > /etc/dogtag
echo "KERNEL==\"uinput\", GROUP=\"video\", MODE:=\"0660\"" > /etc/udev/rules.d/80-lcd-screen.rules
echo "SYSFS{idVendor}==\"0eef\", SYSFS{idProduct}==\"0001\", KERNEL==\"event*\",SYMLINK+=\"input/touchscreen_eGalaxy3\"" >> /etc/udev/rules.d/80-lcd-screen.rules
date=$(date +"%d-%m-%Y")
echo "$VERSION $date" > /etc/kamikaze-release
